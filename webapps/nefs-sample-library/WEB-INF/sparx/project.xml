<?xml version="1.0"?>

<project xmlns:xdm="http://www.netspective.org/Framework/Commons/XMLDataModel">

	<!--
	**********************************************************************
	** NETSPECTIVE FRAMEWORKS' RESOURCE FILES                           **
	********************************************************************** -->

    <xdm:include resource="com/netspective/commons/conf/commons.xml"/>
    <xdm:include resource="com/netspective/axiom/conf/axiom.xml"/>
    <xdm:include resource="com/netspective/sparx/conf/sparx.xml"/>
    <xdm:include resource="com/netspective/sparx/conf/console.xml"/>

	<!--
	**********************************************************************
	** USER INTERFACE (PRESENTATION) SPECIFICATIONS                     **
	********************************************************************** -->

    <navigation-tree name="app" default="yes">
        <page name="home" default="yes" caption="Home" >
            <!--body>
                Welcome to the home page.
            </body-->
            <panels>
                <panel type="command" command="query,library.get-all-books,-,-,-,record-editor"/>
            </panels>
        </page>

        <page name="add" caption="Add Book" command="dialog,library.book-info,add">
            <!--conditional action="apply-flags" hidden="yes" has-value="request:abc"/-->
            <panels>
                <panel type="command" command="dialog,library.book-info,add" />
            </panels>
        </page>
        <page name="edit" caption="Edit Book" command="dialog,library.book-info,edit">
        </page>
        <page name="delete" caption="Delete Book" command="dialog,library.book-info,delete">
        </page>
        <page name="search" caption="Search Books" command="query-defn,library,test,searchBooksDialog"/>
    </navigation-tree>
    
    <dialogs package="library">
        <dialog name="book-info" retain-params="*" hide-hints-until-focus="yes" class="app.form.BookDialog">
            <frame heading="create-dialog-perspective-heading:Book"/>
            <field type="text" name="id" caption="Book ID" required="yes"  hint="This field is required"/>
            <field type="text" name="title" caption="Title" required="yes" hint="This field is required"/>
            <field type="text" name="author" caption="Author" required="yes" hint="This field is required"/>
            <field type="select" name="genre" caption="Genre" choices="query:library.get-book-genre-list"/>
            <field type="text" name="isbn" caption="ISBN"/>
        </dialog>
    </dialogs>

	<!--
	**********************************************************************
	** DATA MANAGEMENT STRUCTURE (SCHEMA) SPECIFICATIONS                **
	********************************************************************** -->

	<schema name="db">
		<xdm:include resource="com/netspective/axiom/conf/schema.xml"/>

		<table name="Book_Info" abbrev="bkI" type="Presentation">
			<column name="id" type="text" size="10" primary-key="yes" descr="Unique ID for every book in the database"/>
			<column name="name" type="text" size="64" descr="Name of the book"/>
            <column name="author" type="text" size="64" descr="Name of the author(s)"/>
			<column name="genre" lookup-ref="Book_Type"/>
			<column name="isbn" type="text" size="10" descr="The 10 digit ISBN number"/>
		</table>

		<table name="Book_Type" abbrev="bkT" type="Enumeration">
			<enumerations>
				<enum>Science Fiction</enum>
				<enum>Mystery</enum>
				<enum>Business</enum>
				<enum>Information Technology</enum>
				<enum>Nuclear Physics</enum>
				<enum>Chemistry</enum>
			</enumerations>
		</table>
	</schema>

	<!--
	**********************************************************************
	** DATA MANAGEMENT QUERY (SQL) SPECIFICATIONS                       **
	********************************************************************** -->

    <queries package="library">

        <query name="get-all-books">
            select * from book_info
            <presentation>
                <panel name="Test">
                    <frame heading="static:Book Report"/>
                    <!--action caption="Frame action" hint="This is a hint" style="horizontal" command="redirect,yahoo.com"/-->
                    <report>
                        <actions>
                            <action type="add" caption="Add Book" command="redirect,add,true"/>
                            <action type="edit" command="redirect,edit?book_id=${0},true"/>
                            <action type="delete" command="redirect,delete,true"/>
                            <action type="select" caption="Process selected rows" title="Process the selected rows"
                                command="redirect,yahoo.com"/>
                        </actions>
                        <column heading="ID" format="plain"/>
                        <column heading="Name" />
                        <column heading="Author"/>
                        <column heading="Genre"/>
                        <column heading="ISBN"/>
                    </report>
                </panel>
            </presentation>
        </query>

        <query name="get-all-book-types">
            select id,caption,abbrev from book_type
        </query>

        <query name="get-book-genre-list">
            select caption,id from book_type
        </query>

        <query name="get-book-info">
            select * from book_info where id = ?

            <params>
                <param value="request:book_id"/>
            </params>
            <presentation>
                <panel name="Test">
                    <frame heading="static:Book Information"/>
                    <report>
                        <column heading="ID"/>
                        <column heading="Name" command="redirect,yahoo.com"/>
                        <column heading="Author"/>
                        <column heading="Genre"/>
                        <column heading="ISBN"/>
                    </report>
                </panel>
            </presentation>
        </query>

    </queries>

    <query-defn name="library">
        <field name="book_id" caption="Book ID" join="BookInfo" column="id"/>
        <field name="name" caption="Name" join="BookInfo" column="name"/>
        <field name="author" caption="Author" join="BookInfo" column="author"/>
        <field name="genre_id" caption="Genre ID" join="BookInfo" column="genre"/>
        <field name="genre_caption" caption="Genre" join="BookType" column="caption"/>
        <field name="isbn" caption="ISBN" join="BookInfo" column="isbn"/>

        <join name="BookInfo" table="book_info"/>
		<join name="BookType" table="book_type" condition="book_type.id = book_info.genre"/>

        <presentation>
            <select-dialog name="searchBooksDialog"  allow-debug="yes" hide-output-dests="yes" hide-readonly-hints="yes" >
                <frame heading="Search for Books" />
                <field type="text" name="book_id" caption="Book ID" />
                <field type="text" name="name" caption="Book Name"/>
                <field type="text" name="author" caption="Author"/>
                <field type="text" name="isbn" caption="ISBN"/>
                <field type="select" style="list" name="genre" caption="Genre" choices="query:library.get-book-genre-list"/>
                <select name="test">
                    <display field="book_id"/>
                    <display field="name"/>
                    <display field="author"/>
                    <display field="genre_caption"/>
                    <display field="isbn"/>
                    <condition field="book_id" allow-null="no" comparison="equals" value="field:book_id" connector="and"/>
                    <condition field="name" allow-null="no" comparison="starts-with" value="field:name" connector="and"/>
                    <condition field="author" allow-null="no" comparison="equals" value="field:author" connector="and"/>
                </select>
            </select-dialog>
        </presentation>
    </query-defn>
</project>
