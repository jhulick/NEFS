<?xml version="1.0" encoding="utf-8"?>
<xdm:container xmlns:xdm="http://www.netspective.org/Framework/Commons/XMLDataModel">

    <xdm:include file="org.xml"/>
    <dialogs package="cts">
        <!--
           This dialog is for adding/updating/deleting person contact information
        -->
        <dialog name="person-contact-info" retain-params="*">
			<frame heading="create-dialog-perspective-heading:Contact"/>
			<field type="text" name="id" caption="ID" read-only="yes" default="request:id">
				<conditional action="apply-flags" flags="unavailable" perspective="add"/>
			</field>
			<field type="composite" name="contactType" caption="Contact Type" required="yes">
				<conditional action="apply-flags" flags="read_only" perspective="edit"/>	
				<field type="select" name="method_type" caption="Contact Type" choices="schema-enum:Contact_Method_Type">
									
				</field>
				<field type="text" name="method_name" caption="Other Contact Type">
					<conditional action="display" partner-field-name="contactType.method_type" expression="control.options[control.selectedIndex].text == 'Other'"/>
				</field>
			</field>
			<field type="text" name="method_value" caption="Contact Information" required="yes" hint="Enter the contact number, email address or other information here."/>
            <on-execute class="app.cts.form.person.PersonContactDialog"/>
            <!--director>
                <next-actions caption="Next Action\:" choices="text-list:a=x" display-single-action="yes"/>
                <next-actions>

                    <choices>
                        <choice value="simple-expr:${servlet-context-uri:/index.jsp}">Return to home</choice>
                        <choice value="simple-expr:${servlet-context-uri:/person/contact.jsp}?person_id=${session:user_person_id}&amp;data_cmd=add">Create another subject</choice>
                    </choices>
                </next-actions>
            </director-->
		</dialog>
    </dialogs>

    <dialogs package="study">
        <!--
           This dialog is for adding/updating/deleting study profile information
        -->
        <dialog name="profile">
            <frame heading="Study Profile"/>
            <field type="separator" heading="Overview"/>
            <field type="text" name="study_id" caption="Study ID" default="request:study_id" hidden="yes"/>
            <field type="text" name="study_name" caption="Name"  uppercase="yes"   max-length="255" required="yes">
                <conditional action="apply-flags" flags="browser_readonly" perspective="edit,delete"/>
            </field>
            <field type="text" name="study_code" caption="Code" max-length="64" required="yes"/>
            <field type="memo" name="study_descr" caption="Description" required="yes"/>
            <field type="select" name="study_status" caption="Status" required="yes" choices="schema-enum:Study_Status" prepend-blank="yes">
                <conditional action="apply-flags" flags="browser_readonly" perspective="edit,delete"/>
            </field>
            <field type="select" name="study_phase" caption="Stage" choices="schema-enum:Study_Stage_Type" prepend-blank="yes"/>
            <field type="select" name="sponsor_org_name" caption="Sponsor" size="50"
                default="request:org_id">
                <conditional action="apply-flags" flags="unavailable" perspective="delete,edit"/>
            </field >
            <field type="phone" name="primary_phone" caption="Contact Phone" size="16" hint="Study Hotline number"/>
            <field type="e-mail" name="primary_email" caption="Contact Email" hint="Study email address"/>

            <field type="separator" heading="Planned Trial Period"/>
            <field type="date" name="start_date" caption="Start Date" required="yes" default="today" format="MM-dd-yyyy" client-calendar-format="MM-dd-yyyy"/>
            <field type="date" name="target_end_date" caption="Target End Date" required="yes" format="MM-dd-yyyy" client-calendar-format="MM-dd-yyyy"/>
            <field type="date" name="actual_end_date" caption="Actual End Date" format="MM-dd-yyyy" client-calendar-format="MM-dd-yyyy">
            </field>

            <field type="separator" heading="Institutional Review Board (IRB) Information" />
            <field type="text" name="irb_name" caption="IRB Name" max-length="255" required="yes"/>
            <field type="text" name="irb_number" caption="IRB Number" max-length="15" required="yes"/>
            <field type="date" name="irb_approval_date" caption="Approval Date"    format="MM-dd-yyyy" client-calendar-format="MM-dd-yyyy"/>
            <field type="date" name="irb_expiration_date" caption="Expiration Date" format="MM-dd-yyyy" client-calendar-format="MM-dd-yyyy"/>

            <!-- declare the classes that are handling the dialog -->
            <on-execute class="app.cts.form.study.StudyDialogExecuteHandler"/>
            <listener class="app.cts.form.study.StudyDialogInitialPopulateListener"/>
        </dialog>
    </dialogs>

    <dialogs package="subject">
        <!--
           This dialog is for adding/updating/deleting a subject's journal entry
        -->
        <dialog name="journal" bind-table="Person_Note" class="app.cts.form.person.JournalDialogHandler" hide-hints-until-focus="yes" auto-bind-fields-to-columns="yes">
            <frame heading="Journal Entry"/>
            <field type="text" caption="Subject ID" name="person_id" hidden="yes" default="authenticated-user:user-id"  bind-column="parent_id"/>
            <field type="text" caption="Subject Name" name="name" read-only="yes" default="authenticated-user:complete_sortable_name" required="yes"/>
            <field type="date-time" caption="Date/Time" name="date" hidden="no" default="now" read-only="yes" bind-column=""/>
            <field type="memo" caption="Journal Entry" name="journal" required="yes" bind-column="notes"/>
            <field type="integer" caption="Note Type ID" name="note_type_id" hidden="yes" default="0" bind-column="note_type_id" />
        </dialog>

        <dialog name="login_info" bind-table="person_login">
            <frame heading="Login Information"/>
            <field type="text" caption="Login ID" name="login_id" default="authenticated-user:user-id" read-only="yes" required="yes"/>
            <field type="text" mask-entry="yes" caption="Old Password" name="old_password"  required="yes"/>
            <field type="text" mask-entry="yes" caption="New Password" name="new_password1" required="yes"/>
            <field type="text" mask-entry="yes" caption="Verify New Password" name="new_password2" required="yes"/>
        </dialog>
        <!--
           This dialog is for adding/updating/deleting a subject's profile information
        -->
        <dialog name="profile" hide-hints-until-focus="yes" bind-table="person" auto-bind-fields-to-columns="yes">
            <field type="integer" name="person_id" hidden="yes" default="request:person_id"/>
            <!--field type="integer" name="person_type" caption="Person Type" hidden="yes"  default="schema-enum:cts."/-->
            <field type="text" name="org_id" hidden="yes" default="request:org_id"/>
            <field type="text" name="study_id" hidden="yes" default="request:study_id"/>

			<field type="separator" heading="Personal Profile"/>
			<field type="composite"  name="fullName" >   <!-- show-child-caption="yes" -->
                <field type="select" name="name_prefix" caption="Prefix" choices="schema-enum:Name_Prefix_Type" prepend-blank="yes"/>
				<field type="text" name="name_last" size="16" caption="Last Name" required="yes" />
                <field type="text" name="name_first" size="16" caption="First Name" required="yes" />
                <field type="text" name="name_middle" size="2" caption="MI" />
                <field type="text" name="name_suffix" size="4" caption="Suffix" />
			</field>

            <field type="separator" heading="Demographic Information"/>
            <field type="date" caption="Date of Birth" name="date_of_birth" size="12"/>
            <field type="ssn" caption="Social Security Number"  name="ssn" required="yes" size="11"/>
			<field type="select" name="gender_id" caption="Gender" choices="schema-enum:Gender_Type" prepend-blank="yes" required="yes"/>
			<field type="select" name="marital_status_id" caption="Marital Status"  choices="schema-enum:Marital_Status_Type"/>
			<field type="select" name="blood_type_id" caption="Blood Type" choices="schema-enum:Blood_Type" required="yes"/>
			<field type="select" caption="Ethnicity" name="ethnicity_id" choices="schema-enum:Ethnicity_Type"
                hint="Please note that the first ethnicity you select will be considered the primary ethnicity of this person."/>
			<field type="select" caption="Language" name="language_id" choices="schema-enum:Language_Type"
                hint="Please note that the first language you select will be considered the primary language of this person."/>

            <field type="separator" heading="Address"/>
            <field type="text" name="line1" caption="Home Address" required="yes" size="64"/>
            <field type="text" name="line2" caption="Line 2" size="64"/>
            <field type="composite" name="cityStateZip" caption="*">
                <field type="text" name="city" caption="City" required="yes" size="16"/>
                <field type="select" name="state" caption="State" choices="schema-enum:US_State_Type" required="yes"/>
                <field type="zip-code" name="zip" caption="Zip Code" required="yes"/>
            </field>
            <on-execute class="app.cts.form.person.SubjectDialogExecuteHandler"/>
            <!--
            <field type="separator" heading="Contact Methods"/>
            <field type="composite" name="primary_contact" >
                <field type="select" name="type" caption="Primary Contact Method" choices="schema-enum:Contact_Method_Type"
                    prepend-blank="yes" required="yes"/>
                <field type="phone" name="phone_value"  size="30">
                    <conditional action="display" partner-field-name="primary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 9) == 'Telephone'"/>
                </field>
                <field type="phone" name="fax_value" size="30">
                    <conditional action="display" partner-field-name="primary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 3) == 'Fax'"/>
                </field>
                <field type="e-mail" name="email_value" size="30">
                    <conditional action="display" partner-field-name="primary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 5) == 'Email'"/>
                </field>
            </field>
            <field type="composite" name="secondary_contact" >
                <field type="select" name="type" caption="Secondary Contact Method" choices="schema-enum:Contact_Method_Type"
                    prepend-blank="yes" required="no"/>
                <field type="phone" name="phone_value"  size="30">
                    <conditional action="display" partner-field-name="secondary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 9) == 'Telephone'"/>
                </field>
                <field  type="phone" name="fax_value" size="30">
                    <conditional action="display" partner-field-name="secondary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 3) == 'Fax'"/>
                </field>
                <field type="e-mail" name="email_value" size="30">
                    <conditional action="display" partner-field-name="secondary_contact.type"
                        expression="control.options[control.selectedIndex].text.substring(0, 5) == 'Email'"/>
                </field>
            </field>
            -->
        </dialog>
    </dialogs>
</xdm:container>