<?xml version="1.0"?>
<xdm:container xmlns:xdm="http://www.netspective.org/Framework/Commons/XMLDataModel">
    <xdm:template name="org-address" >
        <field type="separator" heading="Address Information"/>
        <field type="text" name="address_name" hidden="no" caption="Address Name" default="Mailing Address"/>
        <field type="text" name="line1" caption="Address 1" required="no" size="64" />
        <field type="text" name="line2" caption="Address 2" size="64" />
        <field type="composite" name="cityStateZip" caption="*">
            <field type="text" name="city" caption="City" required="yes" size="16" />
            <field type="select" name="state" caption="State" choices="schema-enum:db.US_State_Type"
                 required="yes"/>
            <field type="zip-code" name="zip" caption="Zip Code" max-length="5" size="7" />
        </field>
        <field type="text" name="country" caption="Country" size="16" />
        <field type="text" name="time_zone" caption="Time Zone"/>

        <field type="separator" heading="Contact Information"/>
        <field type="composite"  name="primary" caption="*">
            <field type="phone"  name="phone" caption="Telephone"/>
            <field type="phone" name="fax" caption="Fax"/>
        </field>
        <field type="e-mail" name="email" caption="E-Mail"/>
        <field type="text" name="website" caption="Web Site"/>
    </xdm:template>

    <xdm:template name="org-profile">
        <field type="text" name="org_name" caption="Organization Name" required="yes" size="32" />
        <field type="text" name="org_code" required="yes" caption="Code" size="16" />
        <field type="text" name="org_abbrev" caption="Abbreviated Name" size="16" />
    </xdm:template>
    
    
    <dialogs package="site">
       <!--
            This is the dialog for creating/updating/deleting trial sites
        -->
        <dialog name="profile" class="com.netspective.sparx.form.schema.SchemaRecordEditorDialog">
            <frame heading="create-dialog-perspective-heading:Site"/>
            <xdm:include template="org-profile"/>
            <xdm:include template="org-address"/>
            <on-add-data>
                <org _auto_map="org_name,org_code,org_abbrev," rec-stat-id="static:Active">
                    <org-classification rec-stat-id="static:Active" org-type-id="static:Trial Site"/>
                </org>
            </on-add-data>
        </dialog>
    </dialogs>
    <!--
        Organization related dialogs
     -->
    <dialogs package="org">
        
        <dialog name="address" class="com.netspective.sparx.form.schema.SchemaRecordEditorDialog">
            <frame heading="create-dialog-perspective-heading:Address"/>
            <xdm:include template="org-address"/>
            <on-add-data>
                <org-address parent-id="request:org_id" rec-stat-id="static:Active"
                    _auto_map="address_name,line1,line2,country"/>
            </on-add-data>
        </dialog>
        <!--
            This is the dialog for creating/updating/deleteing trial sponsors
        -->
        <dialog name="sponsor" class="com.netspective.sparx.form.schema.SchemaRecordEditorDialog">
            <frame heading="create-dialog-perspective-heading:Sponsor"/>
			<xdm:include template="org-profile"/>
            <xdm:include template="org-address"/>
            <on-add-data>
                <org _auto_map="org_name,org_code,org_abbrev," rec-stat-id="static:Active">
                    <org-classification rec-stat-id="static:Active" org-type-id="static:Trial Sponsor"/>
                </org>
            </on-add-data>
		</dialog>


        <!--
            This is the dialog for creating/updating/deleting employees of sponsors and sites
        -->
        <dialog name="employee" retain-params="*" class="com.netspective.sparx.form.schema.SchemaRecordEditorDialog">
            <frame heading="create-dialog-perspective-heading:Employee"/>

            <field type="text" name="org_id" hidden="no" default="request:org_id"/>

            <field type="separator" heading="Employee Profile"/>
            <field type="text" name="name_last" size="16" caption="Last Name" required="yes" />
            <field type="text" name="name_first" size="16" caption="First Name" required="yes" />
            <field type="text" name="name_middle" size="2" caption="MI"  />
            <field type="text" name="name_suffix" size="4" caption="Suffix"  />
            <field type="date" caption="Date of Birth" name="date_of_birth" size="12" />
            <field type="ssn" caption="Social Security Number"  name="ssn" required="yes" size="11" />
			<field type="select" name="gender_id" caption="Gender" choices="schema-enum:Gender_Type" prepend-blank="yes"
                required="yes" />
			<field type="select" name="marital_status_id" caption="Marital Status"
                choices="schema-enum:Marital_Status_Type" />

            <field type="separator" heading="Employment Information"/>
            <field type="text" caption="Employee Number" name="employee_number"  />
            <field type="text" caption="Job Title" name="job_title"/>
            <field type="phone"  name="phone" caption="Telephone"/>
            <field type="e-mail" name="email" caption="E-Mail"/>
            <on-add-data>
                <person _auto-map="name_last,name_first,name_middle,name_suffix,ssn,gender_id,marital_status_id" rec-stat-id="static:Active" >
                    <personorg-relationship rel-entity-id="request:org_id" rec-stat-id="static:Active" rel-type-id="static:Employee"/>
                    <person-contact rec-stat-id="static:Active" method-type="static:Telephone: Business" method-value="phone"
                        _condition="vc.getFieldStates().getState('phone').getValue().hasValue()"/>
                    <person-contact rec-stat-id="static:Active" method-type="static:Email: Business" method-value="email"
                         _condition="vc.getFieldStates().getState('email').getValue().hasValue()"/>
                </person>
            </on-add-data>

            <!--director>
                <next-actions>
                    <choices>
                        <choice value="config-expr:${create-app-url:/account/home.jsp}?project_id=${request:project_id}">Choose next action</choice>
                        <choice value="config-expr:${create-app-url:/account/home.jsp}?project_id=${request:project_id}&amp;project_name=${request:project_name}">Return to project home</choice>
                    </choices>
                </next-actions>
            </director-->
        </dialog>
    </dialogs>
</xdm:container>